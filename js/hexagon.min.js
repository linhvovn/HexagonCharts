!function(){window.HEXAGONS={UTIL:{inheritProperties:function(a,b){if(void 0!=a)for(i in b)void 0==a[i]&&(a[i]=b[i]);else a=b;return a},_inheritClass_:function(a){function b(){}return b.prototype=a,new b},extend:function(a,b){a.prototype=HEXAGONS.UTIL._inheritClass_(b.prototype),a.prototype.constructor=a,a.parent=b.prototype},createInMemoryGroup:function(a,b){var c=b?b:"g",d=document.createElementNS("http://www.w3.org/2000/svg",c);if(a)for(var e in a)d.setAttribute(e,a[e]?a[e]:"");return d},getPointString:function(a){var b="";for(var c in a)b=b+a[c].getString()+" ";return b}},CONST:{HEXAGON:{MAX_RELATIVE:6,RELATEIVE_TYPE:{TOP:0,TOP_RIGHT:1,BOT_RIGHT:2,BOT:3,BOT_LEFT:4,TOP_LEFT:5},OPPOSITE_TYPE:[3,4,5,0,1,2],HEXAGON_DEG:2*Math.PI/6,HEXAGON_DEEP_RATIO:3}},POINT:function(a,b){this.x=a,this.y=b},_BASE:function(a){this.init(a)},HEXAGON:function(a){HEXAGONS.HEXAGON.parent.constructor.apply(this,arguments)},TOWER:function(a){HEXAGONS.TOWER.parent.constructor.apply(this,arguments)},HEXAGON_TOWER:function(a){HEXAGONS.HEXAGON_TOWER.parent.constructor.apply(this,arguments)},HEXAGON_FLOWER:function(a){HEXAGONS.HEXAGON_FLOWER.parent.constructor.apply(this,arguments)},HEXAGON_CHART:function(a){HEXAGONS.HEXAGON_CHART.parent.constructor.apply(this,arguments)}},HEXAGONS.UTIL.extend(HEXAGONS.HEXAGON,HEXAGONS._BASE),HEXAGONS.UTIL.extend(HEXAGONS.TOWER,HEXAGONS._BASE),HEXAGONS.UTIL.extend(HEXAGONS.HEXAGON_TOWER,HEXAGONS._BASE),HEXAGONS.UTIL.extend(HEXAGONS.HEXAGON_FLOWER,HEXAGONS._BASE),HEXAGONS.UTIL.extend(HEXAGONS.HEXAGON_CHART,HEXAGONS._BASE),HEXAGONS.POINT.prototype={init:function(){return this.x+","+this.y},getString:function(){return this.x+","+this.y}},HEXAGONS._BASE.prototype.init=function(a){this.data=HEXAGONS.UTIL.inheritProperties(a,{parent:"svg",center:new HEXAGONS.POINT(50,50),r:50}),this._checkProperty(),this.shapes={},this.parent=d3.select(this.data.parent).node(),this._appendGroup_(),this._afterInit()},HEXAGONS._BASE.prototype.draw=function(){this._prepareDrawing(),this._draw_()},HEXAGONS._BASE.prototype._draw_=function(){d3.select(this.parent).node().appendChild(this.group)},HEXAGONS._BASE.prototype._appendGroup_=function(){void 0!=this.data.css?this.data.css.class=this.data.groupClass:this.data.css={class:this.data.groupClass},this.group=HEXAGONS.UTIL.createInMemoryGroup(this.data.css)},HEXAGONS._BASE.prototype._afterInit=function(a){},HEXAGONS._BASE.prototype._prepareDrawing=function(){},HEXAGONS._BASE.prototype._checkProperty=function(){},HEXAGONS.HEXAGON.prototype._checkProperty=function(){this.data=HEXAGONS.UTIL.inheritProperties(this.data,{groupClass:"hexagon",faces:{topClass:"top",leftClass:"left",bottomClass:"bottom",rightClass:"right"}}),this.attrs={around:[!1,!1,!1,!1,!1,!1],fullRelative:!1}},HEXAGONS.HEXAGON.prototype._afterInit=function(){this._calculatePoints_(),this._calculateViewPort(),this._calculateSide()},HEXAGONS.HEXAGON.prototype._prepareDrawing=function(){this._drawFace(),this._drawSide()},HEXAGONS.HEXAGON.prototype.setRelative=function(a){this.attrs.around[a]=!0,this._reCalculateRelative()},HEXAGONS.HEXAGON.prototype.getNextRelative=function(){if(!this.attrs.fullRelative){var a=0;for(a=0;a<HEXAGONS.CONST.HEXAGON.MAX_RELATIVE&&this.attrs.around[a];++a);if(a<HEXAGONS.CONST.MAX_RELATIVE)return{position:a,center:this._getRelativeCenter(a)};this.attrs.fullRelative=!0}return null},HEXAGONS.HEXAGON.prototype.isLeft=function(a){return this.data.center.isLeft(a.data.center)},HEXAGONS.HEXAGON.prototype.isBottom=function(a){return!this.data.center.isTop(a.data.center)},HEXAGONS.HEXAGON.prototype._getRelativeCenter=function(a){switch(a){case HEXAGONS.CONST.HEXAGON.RELATEIVE_TYPE.TOP:return{x:this.data.center.x,y:this.data.center.y-this.attrs.height};case HEXAGONS.CONST.HEXAGON.RELATEIVE_TYPE.TOP_RIGHT:return{x:this.data.center.x+.75*this.attrs.width,y:this.data.center.y-this.attrs.height/2};case HEXAGONS.CONST.HEXAGON.RELATEIVE_TYPE.BOT_RIGHT:return{x:this.data.center.x+.75*this.attrs.width,y:this.data.center.y+this.attrs.height/2};case HEXAGONS.CONST.HEXAGON.RELATEIVE_TYPE.BOT:return{x:this.data.center.x,y:this.data.center.y+this.attrs.height};case HEXAGONS.CONST.HEXAGON.RELATEIVE_TYPE.BOT_LEFT:return{x:this.data.center.x-.75*this.attrs.width,y:this.data.center.y+this.attrs.height/2};case HEXAGONS.CONST.HEXAGON.RELATEIVE_TYPE.TOP_LEFT:return{x:this.data.center.x-.75*this.attrs.width,y:this.data.center.y-this.attrs.height/2}}},HEXAGONS.HEXAGON.prototype._calculatePoints_=function(){var a=this.data.center.x,b=this.data.center.y,c=this.data.r,d=function(a,b,c,d){var e=HEXAGONS.CONST.HEXAGON.HEXAGON_DEG,f=d*Math.cos(e*a)+b,g=d*Math.sin(e*a)+c,h=Math.abs(f),i=Math.abs(g*Math.cos(2*Math.PI/3));return new HEXAGONS.POINT(h,i)};this.attrs.shapeData={top:{p1:d(1,a,b,c),p2:d(2,a,b,c),p3:d(3,a,b,c),p4:d(4,a,b,c),p5:d(5,a,b,c),p6:d(6,a,b,c)}}},HEXAGONS.HEXAGON.prototype._calculateViewPort=function(){this.attrs.width=2*this.data.r,this.attrs.height=this.attrs.width*Math.sin(HEXAGONS.CONST.HEXAGON.HEXAGON_DEG),this.attrs.deep=this.data.r/HEXAGONS.CONST.HEXAGON.HEXAGON_DEEP_RATIO},HEXAGONS.HEXAGON.prototype._calculateSide=function(){var a=this.attrs.shapeData.top;this.attrs.shapeData.leftRect=this._calculateRectPoints(a.p3,a.p2),this.attrs.shapeData.botRect=this._calculateRectPoints(a.p2,a.p1),this.attrs.shapeData.rightRect=this._calculateRectPoints(a.p1,a.p6)},HEXAGONS.HEXAGON.prototype._calculateRectPoints=function(a,b){var c=new HEXAGONS.POINT(b.x,b.y+this.attrs.deep),d=new HEXAGONS.POINT(a.x,a.y+this.attrs.deep);return{p1:a,p2:b,p3:c,p4:d}},HEXAGONS.HEXAGON.prototype._reCalculateRelative=function(){this.attrs.fullRelative=!1;for(var a=0;a<this.attrs.around.length;++a)if(0==this.attrs.around[a])return;this.attrs.fullRelative=!0},HEXAGONS.HEXAGON.prototype._drawFace=function(){this.shapes.face=d3.select(this.group).append("polygon").attr("class",this.data.faces.topClass).attr("points",HEXAGONS.UTIL.getPointString(this.attrs.shapeData.top)).node()},HEXAGONS.HEXAGON.prototype._drawSide=function(){this.shapes.leftRect=d3.select(this.group).append("polygon").attr("class",this.data.faces.leftClass).attr("points",HEXAGONS.UTIL.getPointString(this.attrs.shapeData.leftRect)).node(),this.shapes.botRect=d3.select(this.group).append("polygon").attr("class",this.data.faces.bottomClass).attr("points",HEXAGONS.UTIL.getPointString(this.attrs.shapeData.botRect)).node(),this.shapes.rightRect=d3.select(this.group).append("polygon").attr("class",this.data.faces.rightClass).attr("points",HEXAGONS.UTIL.getPointString(this.attrs.shapeData.rightRect)).node()}}();